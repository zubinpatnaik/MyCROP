<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MYCROP</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for the graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- D3.js for CSV parsing -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- SheetJS for Excel parsing -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="excel-loader.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="global.css" />
</head>
<body class="bg-gray-900 text-gray-200 font-[Poppins]">
    <div class="flex h-screen">
        <main class="flex-1 p-6 md:p-8 overflow-y-auto">
            <!-- Header -->
            <header class="sticky top-0 z-20 backdrop-blur supports-[backdrop-filter]:bg-gray-900/60 bg-gray-900/80 relative pb-4 pt-4 px-4 -mx-4 md:-mx-8 border-b border-white/10">
                <div class="w-full flex items-center justify-between">
                        <div class="flex items-center space-x-4 flex-1">
                        <div class="w-full">
                            <h1 id="welcome-header" class="text-xl font-bold text-white">WAKANDA FOREVER</h1>
                            <p id="header-subtitle" class="text-xs text-gray-400">Loading Crop Data...</p>
                                <div id="city-filter-wrap" class="mt-2 hidden">
                                    <label class="text-[10px] uppercase tracking-wide text-gray-400 mr-2" for="city-filter">City:</label>
                                    <select id="city-filter" class="bg-gray-800/70 border border-white/10 text-xs rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-green-400 text-gray-200"></select>
                                </div>
                        </div>
                    </div>
                    <nav class="flex items-center space-x-2 md:space-x-4">
                        <a href="main.html" class="text-sm font-semibold text-white px-3 py-2 rounded-lg bg-white/10">Dashboard</a>
                        <a href="my-crops.html" class="text-sm font-medium text-gray-200 hover:text-white px-3 py-2 rounded-lg hover:bg-white/5 transition">My Crops</a>
                        <a href="crops.html" class="text-sm font-medium text-gray-200 hover:text-white px-3 py-2 rounded-lg hover:bg-white/5 transition">Crop Prices</a>
                    </nav>
                </div>
                <!-- Ticker -->
                <div class="w-full mt-2">
                    <div id="crop-ticker-wrap" class="relative overflow-hidden h-10 w-full">
                        <div class="pointer-events-none absolute left-0 top-0 h-full w-12 bg-gradient-to-r from-gray-900/80 to-transparent z-10"></div>
                        <div class="pointer-events-none absolute right-0 top-0 h-full w-12 bg-gradient-to-l from-gray-900/80 to-transparent z-10"></div>
                        <div id="crop-ticker" class="absolute top-0 left-0 whitespace-nowrap will-change-transform"></div>
                    </div>
                </div>
            </header>

            <!-- Dashboard Grid -->
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mt-8">
                <!-- Column 1: Farmer + Field Health -->
                <div class="space-y-8">
                    <div class="bg-gray-800/50 p-6 rounded-2xl border border-white/10 hover:border-green-500/40 transition">
                        <h3 class="text-lg font-bold text-white mb-4">Crop Field Health</h3>
                        <div class="flex items-center space-x-4 mb-4">
                            <img id="farmer-pfp" src="" alt="Farmer" class="w-12 h-12 rounded-full border-2 border-gray-600 object-cover" />
                            <div>
                                <p id="farmer-name" class="font-semibold text-white">Loading...</p>
                                <p id="farmer-id" class="text-xs text-gray-400">ID: Loading...</p>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium text-gray-300">Overall Health</span>
                                <span id="health-status-text" class="text-sm font-semibold text-white">--</span>
                            </div>
                            <div class="w-full h-2.5 bg-gray-700 rounded-full overflow-hidden">
                                <div id="health-bar" class="h-2.5 w-0 bg-green-400 transition-all duration-700"></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-xs mt-4">
                            <div>
                                <p class="text-gray-400">Field Address</p>
                                <p id="field-address" class="font-medium text-gray-300">--</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Field Size</p>
                                <p id="field-size" class="font-medium text-gray-300">--</p>
                            </div>
                        </div>
                    </div>
                    <!-- Quick Market Analysis (replaces old upload card) -->
                    <div class="bg-gray-800/50 p-6 rounded-2xl border border-white/10 hover:border-green-500/30 transition" id="quick-analysis-card">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-white">Quick Market Analysis</h3>
                            <span id="qa-updated" class="text-[10px] text-gray-500">--</span>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-xs" id="qa-metrics">
                            <div class="col-span-2 text-gray-400">Awaiting data...</div>
                        </div>
                        <p class="text-[10px] text-gray-500 mt-4">Auto-computed from latest available prices (per selected city or overall average).</p>
                    </div>

                    <!-- Crop Image Diagnosis (disease prediction quick analysis) -->
                    <div id="diagnosis-card" class="bg-gray-800/50 p-6 rounded-2xl border border-white/10 hover:border-green-500/30 transition">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-white">Crop Image Diagnosis</h3>
                            <button id="diagnosis-reset" class="text-[10px] px-2 py-1 rounded bg-gray-700/60 hover:bg-gray-700 text-gray-300" disabled>Reset</button>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <label for="diagnosis-upload" class="block text-xs uppercase tracking-wide text-gray-400 mb-1">Upload Crop Leaf / Plant Image</label>
                                <input id="diagnosis-upload" type="file" accept="image/*" class="block w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-green-500/20 file:text-green-300 hover:file:bg-green-500/30 cursor-pointer" />
                                <p class="text-[10px] text-gray-500 mt-1">Runs on local TensorFlow model (224x224 MobileNetV2). Only one image at a time.</p>
                            </div>
                            <div class="relative flex items-center justify-center border border-white/10 rounded-lg overflow-hidden bg-gray-900/40 min-h-[140px]">
                                <img id="diagnosis-preview" alt="Preview" class="max-h-40 object-contain hidden" />
                                <div id="diagnosis-placeholder" class="text-[11px] text-gray-500 p-4 text-center">No image selected yet.</div>
                                <div id="diagnosis-loading" class="hidden absolute inset-0 flex items-center justify-center bg-gray-900/70 text-xs text-gray-300">Analyzing...</div>
                            </div>
                            <div id="diagnosis-result" class="text-xs text-gray-400">
                                <p class="text-[11px]">Prediction result will appear here.</p>
                            </div>
                            <div id="diagnosis-health" class="hidden">
                                <div class="flex items-center justify-between mb-1 text-[11px]">
                                    <span class="text-gray-400">Estimated Health Score</span>
                                    <span id="diagnosis-health-text" class="font-semibold text-white">--</span>
                                </div>
                                <div class="w-full h-2 bg-gray-700 rounded-full overflow-hidden">
                                    <div id="diagnosis-health-bar" class="h-2 w-0 bg-green-400 transition-all duration-700"></div>
                                </div>
                            </div>
                            <p class="text-[10px] text-gray-500">Health score is inverse of model confidence (placeholder). Higher score ≈ healthier / less certain disease. Refine later with true severity mapping.</p>
                        </div>
                    </div>
                </div>

                <!-- Column 2: Weather -->
                <div class="space-y-8">
                    <div class="bg-gray-800/50 p-6 rounded-2xl border border-white/10 hover:border-green-500/40 transition">
                        <h3 class="text-lg font-bold text-white mb-4">Local Weather</h3>
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p id="location" class="text-xl font-semibold text-white">--</p>
                                <p id="temperature" class="text-4xl font-bold text-green-400 mt-1">--°C</p>
                            </div>
                            <div id="weather" class="text-sm text-gray-300"></div>
                        </div>
                        <div class="space-y-2" id="forecast">
                            <!-- forecast items injected -->
                        </div>
                    </div>
                    <!-- Satellite Field Health Analysis Widget -->
                    <div class="bg-gray-800/50 p-6 rounded-2xl border border-white/10 hover:border-green-500/40 transition">
                        <div class="flex items-start justify-between mb-4">
                            <h3 class="text-lg font-bold text-white">Satellite Field Health</h3>
                            <button id="toggle-overlay" class="text-xs px-2 py-1 rounded bg-green-600/30 text-green-300 hover:bg-green-600/40 transition" disabled>Overlay: Off</button>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-xs uppercase tracking-wide text-gray-400 mb-1">Upload NDVI / RGB Image</label>
                                <input id="satellite-upload" type="file" accept="image/*" class="block w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-green-500/20 file:text-green-300 hover:file:bg-green-500/30 cursor-pointer" />
                                <p class="text-[10px] text-gray-500 mt-1">If no file chosen, default demo image loads automatically.</p>
                            </div>
                            <div class="relative group border border-white/10 rounded-lg overflow-hidden">
                                <canvas id="satellite-base" class="w-full max-h-64 object-contain bg-black/30"></canvas>
                                <canvas id="satellite-overlay" class="absolute inset-0 w-full h-full pointer-events-none mix-blend-screen opacity-80"></canvas>
                                <div id="satellite-loading" class="hidden absolute inset-0 flex items-center justify-center bg-gray-900/70 text-xs text-gray-300">Processing...</div>
                            </div>
                            <div class="flex items-center justify-between mt-1">
                                <div class="flex items-center space-x-2 text-[10px]">
                                    <span class="inline-flex items-center"><span class="w-3 h-3 rounded-sm bg-red-600 mr-1"></span>Poor</span>
                                    <span class="inline-flex items-center"><span class="w-3 h-3 rounded-sm bg-yellow-400 mr-1"></span>Moderate</span>
                                    <span class="inline-flex items-center"><span class="w-3 h-3 rounded-sm bg-green-500 mr-1"></span>Healthy</span>
                                </div>
                                <span id="satellite-stats" class="text-[10px] text-gray-400">--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Column 3: Chart -->
                <div class="space-y-8 xl:col-span-1">
                    <div class="bg-gray-800/50 p-6 rounded-2xl border border-white/10 hover:border-green-500/40 transition h-[420px] flex flex-col">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-lg font-bold text-white">Price Trends (Last Year)</h3>
                        </div>
                        <div class="flex-1 relative">
                            <canvas id="lastYearChart" class="absolute inset-0"></canvas>
                        </div>
                        <p class="text-[10px] text-gray-500 mt-3">Data from CSV or fallback sample. Prices in ₹ per Quintal.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Single authoritative script include -->
    <script src="main.js"></script>
</body>
</html>


